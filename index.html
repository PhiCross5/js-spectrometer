<!DOCTYPE HTML>
<html>

    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        

        <style>
            .bar{

                background-color:red;
                width:60px;
            }
            body{
                padding:5px;
                width=100%;
                height=100%;
            }
        </style>
    
    </head>


    <body>
    <h1>SPECTRUM ANALYZER v0.1 (proof-of-concept)</h1>
    <p>add any sound file as "song.mp3" to the same folder as the page, reload and click play.</p>
        <div id='volume' class='bar'>ok?</div>
        <audio controls id='sound' src='song.mp3'></audio>
    </body>
    <script defer>
        var audioCtx = new AudioContext();
        var analyser = audioCtx.createAnalyser();

        let audioElement=document.getElementById("sound");
        let source=audioCtx.createMediaElementSource(audioElement);
        
        source.connect(analyser);
        source.connect(audioCtx.destination);

        let data = new Uint8Array(analyser.frequencyBinCount);
        let numBars=6
        var bar=[]
        for(let i=0;i<numBars;i++){
            bar.push(document.createElement("DIV"))
            bar[i].style="background-color:#3310D1; color:white; width:60px;margin:6px;"
            bar[i].textContent="band"+i
            document.body.appendChild(bar[i])
        }

        requestAnimationFrame(loopingFunction);
        function loopingFunction(){
            requestAnimationFrame(loopingFunction);
            analyser.getByteFrequencyData(data);
            for(i=0;i<bar.length;i++){
                bar[i].style.width=(data[Math.round(data.length/bar.length)*i]*2)+"px"
            }
        }

        document.addEventListener('keydown',(event)=>{
           if(event.key=='p')
           song.play();
        });
    </script>
</html>
